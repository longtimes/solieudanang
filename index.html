<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>D·ªØ li·ªáu tr·∫°m</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; }
    table { border-collapse: collapse; width: 80%; margin: 20px auto; background: white; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #333; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    #controls { text-align: center; margin: 20px; }
    select { font-size: 16px; padding: 4px 8px; border-radius: 4px; }
    #bdTable { width: 40%; margin: 10px auto; }
    h2 { text-align: center; margin-top: 30px; }
  </style>
</head>
<body>
  <div id="controls">
    <label for="stationSelect">Ch·ªçn tr·∫°m: </label>
    <select id="stationSelect">
      <option value="553000">Th√†nh M·ªπ</option>
      <option value="553100">H·ªôi Kh√°ch</option>
      <option value="553300">√Åi Nghƒ©a</option>
      <option value="553400">C·∫©m L·ªá</option>
      <option value="552600">Hi·ªáp ƒê·ª©c</option>
      <option value="553600">N√¥ng S∆°n</option>
      <option value="553200">Giao Th·ªßy</option>
      <option value="552700">C√¢u L√¢u</option>
      <option value="553700">H·ªôi An</option>
      <option value="553500">Tam K·ª≥</option>
    </select>
  </div>

  <!-- B·∫£ng ch·ªâ s·ªë Bƒê -->
  <table id="bdTable">
    <thead>
      <tr>
        <th>Bƒê1</th>
        <th>Bƒê2</th>
        <th>Bƒê3</th>
      </tr>
    </thead>
    <tbody>
      <tr id="bdValues">
        <td>-</td>
        <td>-</td>
        <td>-</td>
      </tr>
    </tbody>
  </table>

  <h2 id="stationTitle">D·ªØ li·ªáu tr·∫°m 553600 - N√¥ng S∆°n</h2>
  
  <table id="dataTable">
    <thead>
      <tr>
        <th>M√£ tr·∫°m</th>
        <th>Th·ªùi gian</th>
        <th>S·ªë li·ªáu</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="3">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
    </tbody>
  </table>

  <script>
    const stationNames = {
      "553000": "Th√†nh M·ªπ",
      "553100": "H·ªôi Kh√°ch",
      "553300": "√Åi Nghƒ©a",
      "553400": "C·∫©m L·ªá",
      "552600": "Hi·ªáp ƒê·ª©c",
      "553600": "N√¥ng S∆°n",
      "553200": "Giao Th·ªßy",
      "552700": "C√¢u L√¢u",
      "553700": "H·ªôi An",
      "553500": "Tam K·ª≥"
    };

    // D·ªØ li·ªáu m·ª±c n∆∞·ªõc b√°o ƒë·ªông (Bƒê) theo tr·∫°m
    const bdData = {
      "553000": [15.0, 19.0, 22.0],   // Th√†nh M·ªπ
      "553100": [14.5, 15.5, 16.5],   // H·ªôi Kh√°ch
      "553300": [6.5, 8.0, 9.0],      // √Åi Nghƒ©a
      "553400": [1.0, 2.0, 2.5],      // C·∫©m L·ªá
      "552600": [26.0, 28.0, 30.0],   // Hi·ªáp ƒê·ª©c
      "553600": [11.0, 13.0, 15.0],   // N√¥ng S∆°n
      "553200": [6.5, 7.5, 8.8],      // Giao Th·ªßy
      "552700": [2.0, 3.0, 4.0],      // C√¢u L√¢u
      "553700": [1.0, 1.5, 2.0],      // H·ªôi An
      "553500": [1.7, 2.2, 2.7]       // Tam K·ª≥
    };

    // C·∫≠p nh·∫≠t b·∫£ng m·ª±c n∆∞·ªõc b√°o ƒë·ªông
    function updateBDTable(matram) {
      const tr = document.getElementById('bdValues');
      const values = bdData[matram] || ["-", "-", "-"];
      tr.innerHTML = values.map(v => `<td>${v}</td>`).join('');
    }

    // H√†m t·∫£i d·ªØ li·ªáu t·ª´ API
    async function loadData(matram) {
      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = '<tr><td colspan="3">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>';

      try {
        const now = new Date();
        const pad = (n) => n.toString().padStart(2, '0');
        const today = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`;
        const thoigianbd = `${today} 00:00:00`;
        const thoigiankt = `${today} ${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;

        const apiUrl = `/proxy?matram=${matram}&thoigianbd=${encodeURIComponent("'" + thoigianbd + "'")}&thoigiankt=${encodeURIComponent("'" + thoigiankt + "'")}`;
        const res = await fetch(apiUrl);
        const json = await res.json();

        tbody.innerHTML = '';

        if (!json.data || json.data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="3">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>';
          return;
        }

        document.getElementById('stationTitle').textContent = 
          `D·ªØ li·ªáu tr·∫°m ${matram} - ${stationNames[matram] || ""}`;

        // üëá ƒê·∫£o ng∆∞·ª£c th·ª© t·ª± ƒë·ªÉ hi·ªÉn th·ªã th·ªùi gian m·ªõi nh·∫•t l√™n ƒë·∫ßu
        json.data.slice().reverse().forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.matram}</td>
            <td>${item.Thoigian_SL}</td>
            <td>${item.Solieu}</td>
          `;
          tbody.appendChild(tr);
        });

      } catch (err) {
        console.error("L·ªói t·∫£i d·ªØ li·ªáu:", err);
        tbody.innerHTML = '<tr><td colspan="3">‚ö†Ô∏è L·ªói t·∫£i d·ªØ li·ªáu t·ª´ m√°y ch·ªß</td></tr>';
      }
    }

    // Load d·ªØ li·ªáu m·∫∑c ƒë·ªãnh
    const select = document.getElementById('stationSelect');
    updateBDTable(select.value);
    loadData(select.value);

    // Khi thay ƒë·ªïi tr·∫°m
    select.addEventListener('change', () => {
      updateBDTable(select.value);
      loadData(select.value);
    });
  </script>
</body>
</html>
